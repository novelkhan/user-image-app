<div class="container mt-4">
  <h4>{{ isEdit ? 'Edit User' : 'Create User' }}</h4>

  <form [formGroup]="userForm" (ngSubmit)="onSubmit()">
    <div class="row">
      <!-- Name -->
      <div class="col-md-6 mb-3">
        <label for="name" class="form-label">Name</label>
        <input
          type="text"
          class="form-control"
          id="name"
          formControlName="name"
          [class.is-invalid]="userForm.get('name')?.touched && userForm.get('name')?.invalid"
        />
        <div *ngIf="userForm.get('name')?.touched && userForm.get('name')?.invalid" class="invalid-feedback">
          Name is required
        </div>
      </div>

      <!-- Email -->
      <div class="col-md-6 mb-3">
        <label for="email" class="form-label">Email</label>
        <input
          type="email"
          class="form-control"
          id="email"
          formControlName="email"
          [class.is-invalid]="userForm.get('email')?.touched && userForm.get('email')?.invalid"
        />
        <div *ngIf="userForm.get('email')?.touched && userForm.get('email')?.invalid" class="invalid-feedback">
          Valid email is required
        </div>
      </div>

      <!-- File Input -->
      <div class="col-md-12 mb-3">
        <label for="photos" class="form-label">Upload Photos</label>
        <input
          type="file"
          class="form-control"
          id="photos"
          multiple
          accept="image/*,.pdf"
          formControlName="photos"
          (change)="onFileChange($event)"
        />
      </div>
    </div>

    <!-- Existing Files -->
    <div class="row mb-3" *ngIf="existingFiles.length > 0">
      <h6>Existing Files</h6>
      <div class="d-flex flex-wrap gap-3">
        <div
          *ngFor="let file of existingFiles; let i = index"
          class="border rounded p-2 text-center"
          style="width: 170px; flex-shrink: 0;"
        >
          <ng-container [ngSwitch]="getFileExtension(file.originalName)">
            <!-- Image Preview -->
            <img
              *ngSwitchCase="'jpg'"
              [src]="file.safeUrl"
              class="img-fluid rounded"
              style="height: 150px; width: 150px; object-fit: cover;"
            />
            <img
              *ngSwitchCase="'jpeg'"
              [src]="file.safeUrl"
              class="img-fluid rounded"
              style="height: 150px; width: 150px; object-fit: cover;"
            />
            <img
              *ngSwitchCase="'png'"
              [src]="file.safeUrl"
              class="img-fluid rounded"
              style="height: 150px; width: 150px; object-fit: cover;"
            />
            <img
              *ngSwitchCase="'webp'"
              [src]="file.safeUrl"
              class="img-fluid rounded"
              style="height: 150px; width: 150px; object-fit: cover;"
            />

            <!-- PDF Preview -->
            <iframe
              *ngSwitchCase="'pdf'"
              [attr.src]="file.safeUrl"
              style="height: 150px; width: 150px; object-fit: cover;"
            ></iframe>

            <!-- No Preview -->
            <div
              *ngSwitchDefault
              class="d-flex align-items-center justify-content-center bg-light"
              style="height: 150px; width: 150px; object-fit: cover;"
            >
              <small class="text-muted">No preview</small>
            </div>
          </ng-container>

          <small class="d-block mt-2 text-break fw-semibold" style="font-size: 0.75rem;">
            {{ file.originalName }}
          </small>

          <button
            type="button"
            class="btn btn-sm btn-outline-danger mt-1"
            (click)="removeExistingImage(i)"
          >
            Remove
          </button>
        </div>
      </div>
    </div>

    <!-- New Files -->
    <div class="row mb-3" *ngIf="newFiles.length > 0">
      <h6>New Files</h6>
      <div class="d-flex flex-wrap gap-3">
        <div
          *ngFor="let file of newFiles; let i = index"
          class="border rounded p-2 text-center"
          style="width: 170px; flex-shrink: 0;"
        >
          <ng-container [ngSwitch]="getFileExtension(file.name)">
            <!-- Image Preview -->
            <img
              *ngSwitchCase="'jpg'"
              [src]="file.safeUrl"
              class="img-fluid rounded"
              style="height: 150px; width: 150px; object-fit: cover;"
            />
            <img
              *ngSwitchCase="'jpeg'"
              [src]="file.safeUrl"
              class="img-fluid rounded"
              style="height: 150px; width: 150px; object-fit: cover;"
            />
            <img
              *ngSwitchCase="'png'"
              [src]="file.safeUrl"
              class="img-fluid rounded"
              style="height: 150px; width: 150px; object-fit: cover;"
            />
            <img
              *ngSwitchCase="'webp'"
              [src]="file.safeUrl"
              class="img-fluid rounded"
              style="height: 150px; width: 150px; object-fit: cover;"
            />

            <!-- PDF Preview -->
            <iframe
              *ngSwitchCase="'pdf'"
              [attr.src]="file.safeUrl"
              style="height: 150px; border: none; width: 150px;"
              allow="fullscreen"
            ></iframe>

            <!-- No Preview -->
            <div
              *ngSwitchDefault
              class="d-flex align-items-center justify-content-center bg-light"
              style="height: 150px; width: 150px; object-fit: cover;"
            >
              <small class="text-muted">No preview</small>
            </div>
          </ng-container>

          <small class="d-block mt-2 text-break fw-semibold" style="font-size: 0.75rem;">
            {{ file.name }}
          </small>

          <button
            type="button"
            class="btn btn-sm btn-outline-danger mt-1"
            (click)="removeNewImage(i)"
          >
            Remove
          </button>
        </div>
      </div>
    </div>

    <!-- Submit Button -->
    <div class="col-md-12 mb-5">
      <button type="submit" class="btn btn-primary">
        {{ isEdit ? 'Update' : 'Create' }}
      </button>
      <a [routerLink]="['/']" class="btn btn-secondary ms-2">Cancel</a>
    </div>
  </form>
</div>